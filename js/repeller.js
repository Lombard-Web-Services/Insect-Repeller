// Copyright Â© By Lombard Web https://github.com/Lombard-Web-Services
$(function(){$(".btn").click(function(){$(this).toggleClass("is-clicked")}),$(".debug").click(function(){"hidden"==$(".displayed").css("visibility")?$(".displayed").css("visibility","visible"):$(".displayed").css("visibility","hidden")});let e,t,i,n,l,d=document.getElementById("canvas"),h=d.getContext("2d"),a=new AudioContext,g=document.getElementById("on-off"),o=document.getElementById("osc-type"),c=document.getElementById("frequency"),s=document.getElementById("gain"),r=new GainNode(a,{gain:.5}),y=new AnalyserNode(a,{smoothingTimeConstant:1,fftSize:2048}),u=new Uint8Array(y.frequencyBinCount);d.width=window.innerWidth,d.height=window.innerHeight,i=window.devicePixelRatio,n=d.getBoundingClientRect(),d.width=n.width*i,d.height=n.height*i,d.style.width=d.width/i+"px",d.style.height=d.height/i+"px",(gradient=h.createLinearGradient(0,0,0,d.height)).addColorStop(0,"rgba(125,118,118,123)"),gradient.addColorStop(1,"rgba(0,0,0,0)"),h.fillStyle=gradient,h.fillRect(0,0,d.width,d.height),h.strokeStyle="#FFFFFF",h.beginPath(),h.moveTo(0,d.height/2),h.lineTo(d.width,d.height/2),h.stroke(),g.addEventListener("click",()=>{t?e&&e.stop():((e=new OscillatorNode(a,{type:o.value,frequency:c.value})).connect(r),r.connect(y),y.connect(a.destination),e.start(),f()),document.getElementById("led").classList.toggle("on"),t=!t}),c.addEventListener("input",i=>{let n=i.target.value;document.getElementById("frequencyValue").innerHTML=n,e&&t&&(e.frequency.value=n)}),o.addEventListener("change",i=>{e&&t&&(e.type=i.target.value)}),s.addEventListener("input",i=>{let n=i.target.value;document.getElementById("gainValue").innerHTML=n,e&&t&&(r.gain.value=n)});let f=()=>{if(y.getByteTimeDomainData(u),l=d.width/y.frequencyBinCount,h.fillRect(0,0,d.width,d.height),h.beginPath(),h.moveTo(-100,d.height/2),t)for(let e=1;e<y.frequencyBinCount;e+=1){let i=e*l,n=u[e]/128*d.height/2;h.lineTo(i,n)}h.lineTo(d.width+100,d.height/2),h.stroke(),requestAnimationFrame(f)}});
